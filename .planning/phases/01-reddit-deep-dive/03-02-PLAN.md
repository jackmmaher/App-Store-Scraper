---
phase: 01-reddit-deep-dive
plan: 06
type: execute
---

<objective>
Integrate Reddit Deep Dive UI into the competitor detail page flow.

Purpose: Connect the components to the actual competitor workflow.
Output: Working end-to-end flow from competitor card to Reddit analysis.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./03-02-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-reddit-deep-dive/03-01-SUMMARY.md
@docs/plans/2026-02-01-reddit-deep-dive-design.md

Relevant source files:
@app/projects/[id]/page.tsx
@components/reddit/SearchConfigPanel.tsx
@components/reddit/UnmetNeedsPanel.tsx
@components/reddit/TrendsSentimentPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "Reddit Deep Dive" button to competitor display</name>
  <files>app/projects/[id]/page.tsx</files>
  <action>
In the competitor section of the project detail page:

1. Find where competitor cards/items are rendered (after reviews are scraped)
2. Add a "Reddit Deep Dive" button that:
   - Only shows when competitor has scraped_reviews (reviews exist)
   - Is disabled if reviews not yet scraped (show tooltip: "Scrape reviews first")
   - Opens the SearchConfigPanel in a modal or inline section

State management:
```typescript
const [showRedditConfig, setShowRedditConfig] = useState<string | null>(null); // competitorId or null
const [redditAnalysis, setRedditAnalysis] = useState<Record<string, RedditAnalysisResult>>({});
const [isAnalyzing, setIsAnalyzing] = useState(false);
```

When button clicked: `setShowRedditConfig(competitor.app_store_id)`

Pass appropriate handlers to SearchConfigPanel.
  </action>
  <verify>Button appears on competitors with reviews, disabled on those without</verify>
  <done>"Reddit Deep Dive" button integrated into competitor display</done>
</task>

<task type="auto">
  <name>Task 2: Wire up analysis flow and results display</name>
  <files>app/projects/[id]/page.tsx</files>
  <action>
Complete the integration:

1. When SearchConfigPanel calls onAnalyze:
   ```typescript
   const handleRedditAnalyze = async (config: RedditSearchConfig) => {
     setIsAnalyzing(true);
     try {
       const response = await fetch('/api/reddit/analyze', {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify(config),
       });
       const result = await response.json();
       setRedditAnalysis(prev => ({ ...prev, [config.competitorId]: result }));
       setShowRedditConfig(null);
     } catch (error) {
       console.error('Reddit analysis failed:', error);
       // Show error toast/message
     } finally {
       setIsAnalyzing(false);
     }
   };
   ```

2. Load existing analysis on page load:
   - For each competitor with reddit_analysis_id, fetch from `/api/reddit/analysis/[competitorId]`
   - Store in redditAnalysis state

3. Display results:
   - When analysis exists for a competitor, show the two-column layout:
     - Left: UnmetNeedsPanel
     - Right: TrendsSentimentPanel
   - Handle solution changes by calling `/api/reddit/solutions`

4. Show loading state during analysis (can take 1-2 minutes for Reddit scraping)
  </action>
  <verify>Full flow works: click button → configure → analyze → see results</verify>
  <done>Analysis flow and results display fully integrated</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Reddit Deep Dive integration</what-built>
  <how-to-verify>
    1. Run: `npm run dev` and `npm run dev:crawl` (or however crawl-service starts)
    2. Navigate to a project with a competitor that has scraped reviews
    3. Click "Reddit Deep Dive" button
    4. Verify config panel shows with pre-populated terms
    5. Adjust terms if desired, click "Run Reddit Deep Dive"
    6. Wait for analysis (may take 1-2 minutes)
    7. Verify results display:
       - Unmet needs with severity badges
       - Solution textareas are editable
       - Trends/sentiment panel shows metrics
    8. Add solution notes and verify they save
    9. Refresh page, verify analysis persists
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Full flow works end-to-end
- [ ] Data persists across page refresh
</verification>

<success_criteria>

- All tasks completed
- Human verification approved
- Reddit Deep Dive feature fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/01-reddit-deep-dive/03-02-SUMMARY.md`
</output>
