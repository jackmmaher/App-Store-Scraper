---
phase: 01-reddit-deep-dive
plan: 07
type: execute
---

<objective>
Enhance the competitor AI analysis to combine reviews + Reddit + solution annotations.

Purpose: Create holistic competitive intelligence from both data sources.
Output: Enhanced analysis endpoint that produces richer insights.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./04-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-reddit-deep-dive/03-02-SUMMARY.md
@docs/plans/2026-02-01-reddit-deep-dive-design.md

Relevant source files:
@app/api/projects/[id]/competitors/[appId]/analyze/route.ts
@lib/reddit/types.ts
@lib/supabase.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update analysis endpoint to accept Reddit data</name>
  <files>app/api/projects/[id]/competitors/[appId]/analyze/route.ts</files>
  <action>
Modify the existing analyze endpoint to:

1. Check if competitor has reddit_analysis_id
2. If yes, fetch the RedditAnalysisResult including solution annotations
3. Enhance the Claude prompt to include Reddit insights:

```typescript
const redditSection = redditAnalysis ? `

=== REDDIT MARKET INSIGHTS ===
(What the BROADER market needs - beyond this app's users)

Unmet Needs Identified:
${redditAnalysis.unmetNeeds.map(need => `
- ${need.title} [Severity: ${need.severity}]
  Problem: ${need.description}
  Evidence: ${need.evidence.postCount} posts, ${need.evidence.avgUpvotes} avg upvotes
  User's Solution Approach: ${need.solutionNotes || "Not yet defined"}
`).join('')}

Market Signals:
- Discussion volume: ${redditAnalysis.trends.discussionVolume} posts/month
- Trend: ${redditAnalysis.trends.trendDirection} (${redditAnalysis.trends.percentChange}% vs 3 months ago)
- Sentiment: ${redditAnalysis.sentiment.frustrated}% frustrated, ${redditAnalysis.sentiment.seekingHelp}% seeking help
- Top communities: ${redditAnalysis.topSubreddits.map(s => `r/${s.name}`).join(', ')}
` : '';
```

4. Update the analysis instructions to Claude:
```
Generate competitive intelligence that:
1. Identifies what this app does well (to learn from)
2. Identifies app-level weaknesses (from reviews)
${redditAnalysis ? '3. Identifies problem-domain gaps (from Reddit) with user\'s proposed solutions' : ''}
${redditAnalysis ? '4. Creates strategic positioning based on solving what competitors miss' : '3. Creates strategic positioning'}
```

5. Enhance output parsing to extract `problemDomainGaps` if Reddit data present
  </action>
  <verify>
Test with competitor that has Reddit analysis:
- Analysis includes Reddit insights section
- Output mentions problem-domain gaps when Reddit data exists
  </verify>
  <done>Analysis endpoint combines reviews + Reddit when available</done>
</task>

<task type="auto">
  <name>Task 2: Add problemDomainGaps to analysis output</name>
  <files>lib/supabase.ts, app/api/projects/[id]/competitors/[appId]/analyze/route.ts</files>
  <action>
1. Update the linked_competitors table handling to store enhanced analysis:
   - The ai_analysis field already stores the full text
   - Add parsing to extract structured problemDomainGaps if present

2. Update the Claude prompt to request structured output for problem-domain gaps:
```
If Reddit data is provided, also output a section:

## Problem-Domain Gaps
For each unmet need from Reddit:
| Need | How Competitors Fail | Proposed Solution | Strategic Value |
|------|---------------------|-------------------|-----------------|
| ... | ... | ... | ... |
```

3. The frontend will parse this from the ai_analysis text (keep it simple for v1)

Alternative (cleaner): Have Claude return JSON for the problem-domain gaps section, parse it in the API, and store separately. But for v1, keeping it in the markdown analysis is simpler.
  </action>
  <verify>Enhanced analysis includes problem-domain gaps table when Reddit data exists</verify>
  <done>Problem-domain gaps included in analysis output</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Analysis with Reddit data produces richer output
- [ ] Analysis without Reddit data still works (backwards compatible)
</verification>

<success_criteria>

- All tasks completed
- Enhanced analysis combines both data sources
- Backwards compatible with competitors without Reddit analysis
</success_criteria>

<output>
After completion, create `.planning/phases/01-reddit-deep-dive/04-01-SUMMARY.md`
</output>
