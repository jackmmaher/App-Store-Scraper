---
phase: 01-reddit-deep-dive
plan: 08
type: execute
---

<objective>
Integrate enhanced competitive intelligence into the blueprint strategy section.

Purpose: Ensure blueprints address problem-domain differentiation, not just app-level improvements.
Output: Blueprint Pareto/Strategy section explicitly uses Reddit insights and user solutions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./05-01-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-reddit-deep-dive/04-01-SUMMARY.md
@docs/plans/2026-02-01-reddit-deep-dive-design.md

Relevant source files:
@lib/blueprint-prompts.ts
@app/api/blueprint/generate/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update blueprint prompts to include Reddit context</name>
  <files>lib/blueprint-prompts.ts</files>
  <action>
Find the Pareto/Strategy section prompt and enhance it:

1. Add a parameter for Reddit analysis data:
```typescript
interface BlueprintContext {
  // existing fields...
  redditAnalysis?: {
    unmetNeeds: UnmetNeed[];
    trends: TrendAnalysis;
    sentiment: SentimentBreakdown;
  };
}
```

2. In the Pareto prompt, add the strategic context section when Reddit data exists:

```
${context.redditAnalysis ? `
=== STRATEGIC CONTEXT ===

This blueprint must address THREE levels of competitive advantage:

1. APP-LEVEL IMPROVEMENTS
${context.competitorWeaknesses || 'See competitor analysis above'}

2. PROBLEM-DOMAIN DIFFERENTIATION
${context.redditAnalysis.unmetNeeds.map(need => `
Unmet Need: ${need.title}
How competitors fail: ${need.description}
Our approach: ${need.solutionNotes || 'To be defined'}
Why it matters: Evidence from ${need.evidence.postCount} Reddit posts
`).join('\n')}

3. MARKET POSITIONING
Based on ${context.redditAnalysis.trends.discussionVolume} monthly discussions trending ${context.redditAnalysis.trends.trendDirection}:
- Primary audience sentiment: ${context.redditAnalysis.sentiment.frustrated}% frustrated, ${context.redditAnalysis.sentiment.seekingHelp}% seeking help
` : ''}
```

3. Update the Pareto instructions:
```
The 80/20 analysis must prioritize features that:
- Fix the obvious app issues (table stakes)
${context.redditAnalysis ? '- Solve the deeper problem-domain gaps (differentiation)' : ''}
${context.redditAnalysis ? '- Align with the proposed solution approaches (strategic intent)' : ''}
- Deliver maximum user value with minimum complexity
```
  </action>
  <verify>Prompts compile without errors, template strings produce valid output</verify>
  <done>Blueprint prompts enhanced with Reddit strategic context</done>
</task>

<task type="auto">
  <name>Task 2: Update blueprint generation to fetch and pass Reddit data</name>
  <files>app/api/blueprint/generate/route.ts</files>
  <action>
Modify the blueprint generation endpoint:

1. When generating for a project with competitors:
   - For each competitor with reddit_analysis_id, fetch the RedditAnalysisResult
   - Aggregate or select the primary competitor's Reddit analysis

2. Pass Reddit data to the prompt builder:
```typescript
const redditAnalysis = await getRedditAnalysisForProject(projectId);
const context = {
  ...existingContext,
  redditAnalysis: redditAnalysis || undefined,
};
```

3. Create helper function `getRedditAnalysisForProject`:
```typescript
async function getRedditAnalysisForProject(projectId: string): Promise<RedditAnalysisResult | null> {
  // Get competitors for project
  const competitors = await getLinkedCompetitors(projectId);

  // Find first competitor with Reddit analysis
  for (const competitor of competitors) {
    if (competitor.reddit_analysis_id) {
      const analysis = await getRedditAnalysisById(competitor.reddit_analysis_id);
      if (analysis) return analysis;
    }
  }
  return null;
}
```

4. Handle the case where no Reddit analysis exists (backwards compatible)
  </action>
  <verify>Blueprint generation works with and without Reddit data</verify>
  <done>Blueprint generation incorporates Reddit strategic context when available</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Reddit Deep Dive integration into blueprint pipeline</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Navigate to a project with:
       - A linked competitor
       - Scraped reviews
       - Reddit Deep Dive analysis completed
       - Solution annotations added
    3. Generate a new blueprint (Pareto/Strategy section)
    4. Verify the strategy section includes:
       - Problem-domain differentiation based on Reddit unmet needs
       - Your solution annotations referenced
       - Market evidence (discussion volume, trend, sentiment)
    5. Compare to a blueprint without Reddit data - should still work but with less strategic depth
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Blueprints with Reddit data have enhanced strategy section
- [ ] Blueprints without Reddit data still generate correctly
- [ ] Strategy addresses problem-domain gaps with user's solutions
</verification>

<success_criteria>

- All tasks completed
- Human verification approved
- Blueprint strategy explicitly uses Reddit insights + user solutions
- Feature complete and ready for use
</success_criteria>

<output>
After completion, create `.planning/phases/01-reddit-deep-dive/05-01-SUMMARY.md`:

# Phase 5 Plan 1: Blueprint Integration Summary

**Reddit Deep Dive feature complete - blueprints now address both app-level and problem-domain differentiation**

## Accomplishments

- Enhanced Pareto/Strategy prompts with Reddit strategic context
- Blueprint generation fetches and passes Reddit analysis data
- User solution annotations flow through to blueprint output
- Backwards compatible with projects without Reddit analysis

## Files Modified

- `lib/blueprint-prompts.ts` - Added strategic context section
- `app/api/blueprint/generate/route.ts` - Fetches and passes Reddit data

## Feature Complete

The Reddit Deep Dive feature is now fully integrated:
1. User scrapes reviews for competitor
2. User clicks "Reddit Deep Dive" → configures search → runs analysis
3. User annotates unmet needs with solution approaches
4. "Analyze" combines reviews + Reddit insights
5. Blueprint strategy explicitly addresses problem-domain differentiation

## Next Steps

- Monitor usage and gather feedback
- Consider enhancements: streaming analysis, multiple competitor Reddit aggregation
</output>
