---
phase: 01-reddit-deep-dive
plan: 01
type: execute
---

<objective>
Create TypeScript types, database tables, and the config generation API for Reddit Deep Dive.

Purpose: Establish the data foundation that all subsequent phases depend on.
Output: Working `/api/reddit/generate-config` endpoint that returns search config from app metadata + reviews.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./01-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@docs/plans/2026-02-01-reddit-deep-dive-design.md

Relevant source files:
@lib/opportunity/types.ts
@lib/opportunity/trend-fetcher.ts
@lib/opportunity/constants.ts
@app/api/projects/[id]/competitors/[appId]/analyze/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Reddit types and interfaces</name>
  <files>lib/reddit/types.ts</files>
  <action>
Create TypeScript interfaces for Reddit Deep Dive feature:

```typescript
// Search configuration
interface RedditSearchConfig {
  competitorId: string;
  problemDomain: string;
  searchTopics: string[];
  subreddits: string[];
  timeRange: 'week' | 'month' | 'year';
}

// Analysis results
interface RedditAnalysisResult {
  id: string;
  competitorId: string;
  searchConfig: RedditSearchConfig;
  unmetNeeds: UnmetNeed[];
  trends: TrendAnalysis;
  sentiment: SentimentBreakdown;
  languagePatterns: string[];
  topSubreddits: SubredditSummary[];
  rawData: { postsAnalyzed: number; commentsAnalyzed: number; dateRange: { start: string; end: string } };
  createdAt: string;
}

interface UnmetNeed {
  id: string;
  title: string;
  description: string;
  severity: 'high' | 'medium' | 'low';
  evidence: {
    postCount: number;
    avgUpvotes: number;
    topSubreddits: string[];
    representativeQuotes: string[];
  };
  solutionNotes: string | null;
}

interface TrendAnalysis {
  discussionVolume: number;
  trendDirection: 'rising' | 'stable' | 'declining';
  percentChange: number;
}

interface SentimentBreakdown {
  frustrated: number;
  seekingHelp: number;
  successStories: number;
}

interface SubredditSummary {
  name: string;
  postCount: number;
  avgEngagement: number;
}
```

Export all interfaces. Follow existing patterns from `lib/opportunity/types.ts`.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit lib/reddit/types.ts`</verify>
  <done>All Reddit interfaces exported, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Create config generator with Claude prompt</name>
  <files>lib/reddit/config-generator.ts</files>
  <action>
Create the config generation logic that:

1. Takes competitorId, fetches competitor data + scraped reviews from Supabase
2. Parses app name, description, category for keywords
3. Runs a Claude prompt on sampled reviews to extract: "What problem is the user trying to solve?"
4. Maps category to subreddits using extended CATEGORY_SUBREDDITS (copy from constants.ts and extend)
5. Returns RedditSearchConfig with:
   - problemDomain: AI-derived summary
   - searchTopics: Keywords from app + AI analysis
   - subreddits: Category mapping + AI suggestions
   - timeRange: default 'month'

Claude prompt should be concise - max 1000 tokens, focused on extracting:
- The core problem/need users are trying to address
- 5-8 relevant search keywords
- 3-5 suggested subreddits beyond category defaults

Use existing Claude API pattern from analyze/route.ts. Handle errors gracefully with fallback to app metadata only.
  </action>
  <verify>Manual test: Import and call with a test competitorId, verify returns valid RedditSearchConfig structure</verify>
  <done>Config generator returns structured RedditSearchConfig with AI-derived problem domain and keywords</done>
</task>

<task type="auto">
  <name>Task 3: Create generate-config API endpoint</name>
  <files>app/api/reddit/generate-config/route.ts</files>
  <action>
Create POST endpoint:

Input: `{ competitorId: string }`
Output: `RedditSearchConfig`

1. Check authentication (use isAuthenticated from lib/auth)
2. Validate competitorId exists and has scraped reviews
3. Call config generator
4. Return config or error

Follow existing API route patterns (see analyze/route.ts). Include proper error handling with meaningful messages.
  </action>
  <verify>
Test with curl:
```
curl -X POST http://localhost:3000/api/reddit/generate-config \
  -H "Content-Type: application/json" \
  -d '{"competitorId": "test-id"}' \
  --cookie "auth-token=..."
```
Returns 200 with RedditSearchConfig structure (or 404 if competitor not found)
  </verify>
  <done>API endpoint returns config for valid competitor, proper errors for invalid requests</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Types import correctly in other files
- [ ] API endpoint responds to requests
- [ ] Config generator handles missing/empty reviews gracefully
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- API returns valid RedditSearchConfig structure
</success_criteria>

<output>
After completion, create `.planning/phases/01-reddit-deep-dive/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Foundation Summary

**[One-liner describing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `lib/reddit/types.ts` - TypeScript interfaces for Reddit analysis
- `lib/reddit/config-generator.ts` - Config generation with Claude
- `app/api/reddit/generate-config/route.ts` - API endpoint

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 01-02-PLAN.md (Database tables)
</output>
